# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ TegBot

## –û–±–∑–æ—Ä

TegBot –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

- üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è**: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
- üìà **–ú–µ—Ç—Ä–∏–∫–∏**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π
- üö® **–ê–ª–µ—Ä—Ç—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- üìä **–î–∞—à–±–æ—Ä–¥—ã**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- üõ†Ô∏è **–û—Ç–ª–∞–¥–∫–∞**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥–∞ health check

```bash
php artisan teg:health
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```
üè• TegBot Health Check Report

‚úÖ Telegram API: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ (150ms)
‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞: –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ Webhook: –ê–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
‚úÖ –ö—ç—à: Redis –¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤: –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∑–∞–ø–∏—Å–∏
‚úÖ –ü–∞–º—è—Ç—å: 45MB / 128MB (35%)
‚úÖ –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 2 –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥

‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
- –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: 1 —á–∞—Å –Ω–∞–∑–∞–¥ (HTTP 429 - Rate limit)
- –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –¥–∏—Å–∫: 85%

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞:
- –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: 1,247
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥: 389
- –û—à–∏–±–æ–∫ API: 12
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 156
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```php
class BotHealthChecker
{
    public function checkHealth(): array
    {
        return [
            'api' => $this->checkTelegramAPI(),
            'webhook' => $this->checkWebhook(),
            'database' => $this->checkDatabase(),
            'cache' => $this->checkCache(),
            'storage' => $this->checkStorage(),
            'memory' => $this->checkMemory(),
            'activity' => $this->checkRecentActivity(),
            'errors' => $this->getRecentErrors(),
        ];
    }
    
    private function checkTelegramAPI(): array
    {
        $startTime = microtime(true);
        
        try {
            $response = Http::timeout(10)->get(
                "https://api.telegram.org/bot" . config('tegbot.token') . "/getMe"
            );
            
            $responseTime = round((microtime(true) - $startTime) * 1000);
            
            if ($response->successful()) {
                return [
                    'status' => 'ok',
                    'response_time' => $responseTime . 'ms',
                    'bot_info' => $response->json()['result'],
                ];
            }
            
            return [
                'status' => 'error',
                'message' => 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' . $response->status(),
            ];
            
        } catch (Exception $e) {
            return [
                'status' => 'error',
                'message' => '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' . $e->getMessage(),
            ];
        }
    }
    
    private function checkWebhook(): array
    {
        try {
            $response = Http::get(
                "https://api.telegram.org/bot" . config('tegbot.token') . "/getWebhookInfo"
            );
            
            if ($response->successful()) {
                $info = $response->json()['result'];
                
                return [
                    'status' => $info['url'] ? 'active' : 'inactive',
                    'url' => $info['url'] ?? null,
                    'pending_updates' => $info['pending_update_count'] ?? 0,
                    'last_error' => $info['last_error_message'] ?? null,
                    'last_error_date' => $info['last_error_date'] ?? null,
                ];
            }
            
            return ['status' => 'error', 'message' => '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é'];
            
        } catch (Exception $e) {
            return ['status' => 'error', 'message' => $e->getMessage()];
        }
    }
    
    private function checkMemory(): array
    {
        $used = memory_get_usage(true);
        $limit = $this->parseMemoryLimit(ini_get('memory_limit'));
        $percentage = $limit > 0 ? round(($used / $limit) * 100, 1) : 0;
        
        return [
            'used' => $this->formatBytes($used),
            'limit' => $this->formatBytes($limit),
            'percentage' => $percentage,
            'status' => $percentage > 80 ? 'warning' : 'ok',
        ];
    }
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

```php
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
$this->logActivity('user_interaction', [
    'type' => 'command',
    'command' => '/start',
    'user_id' => 123456789,
    'chat_id' => -1001234567890,
    'chat_type' => 'private',
    'timestamp' => now()->toISOString(),
    'response_time_ms' => 150,
    'memory_usage' => memory_get_usage(true),
]);

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
$this->logError('API Request Failed', $exception, [
    'method' => 'sendMessage',
    'endpoint' => 'https://api.telegram.org/bot{token}/sendMessage',
    'user_id' => 123456789,
    'attempt' => 2,
    'http_code' => 429,
]);
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```php
// config/tegbot.php
'logging' => [
    'enabled' => true,
    'level' => env('TEGBOT_LOG_LEVEL', 'info'),
    'channels' => [
        'default' => 'stack',
        'errors' => 'daily',
        'activity' => 'tegbot_activity',
        'security' => 'tegbot_security',
    ],
    'max_entries' => 10000,
    'retention_days' => 30,
    'structured_logs' => true,
],
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã

```php
// config/logging.php
'channels' => [
    'tegbot_activity' => [
        'driver' => 'daily',
        'path' => storage_path('logs/tegbot/activity.log'),
        'level' => 'info',
        'days' => 14,
        'formatter' => \App\Logging\TegBotFormatter::class,
    ],
    
    'tegbot_security' => [
        'driver' => 'daily', 
        'path' => storage_path('logs/tegbot/security.log'),
        'level' => 'warning',
        'days' => 90,
    ],
],
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫

```php
class BotMetrics
{
    public function collectMetrics(): array
    {
        $now = now();
        $dayAgo = $now->copy()->subDay();
        $weekAgo = $now->copy()->subWeek();
        
        return [
            'messages' => [
                'last_24h' => $this->getMessageCount($dayAgo, $now),
                'last_week' => $this->getMessageCount($weekAgo, $now),
                'by_type' => $this->getMessagesByType($dayAgo, $now),
            ],
            'users' => [
                'active_24h' => $this->getActiveUsersCount($dayAgo, $now),
                'new_users' => $this->getNewUsersCount($dayAgo, $now),
                'total_users' => $this->getTotalUsersCount(),
            ],
            'commands' => [
                'executions' => $this->getCommandExecutions($dayAgo, $now),
                'most_popular' => $this->getMostPopularCommands($dayAgo, $now),
                'errors' => $this->getCommandErrors($dayAgo, $now),
            ],
            'performance' => [
                'avg_response_time' => $this->getAverageResponseTime($dayAgo, $now),
                'error_rate' => $this->getErrorRate($dayAgo, $now),
                'uptime' => $this->getUptime(),
            ],
        ];
    }
    
    private function getMessageCount($from, $to): int
    {
        return DB::table('tegbot_activity_logs')
            ->where('event', 'message_received')
            ->whereBetween('created_at', [$from, $to])
            ->count();
    }
    
    private function getMessagesByType($from, $to): array
    {
        return DB::table('tegbot_activity_logs')
            ->select('data->message_type as type', DB::raw('count(*) as count'))
            ->where('event', 'message_received')
            ->whereBetween('created_at', [$from, $to])
            ->groupBy('data->message_type')
            ->pluck('count', 'type')
            ->toArray();
    }
}
```

### –î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫

```php
$this->registerCommand('stats', function () {
    $this->showBotStats();
}, [
    'description' => '–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞',
    'admin_only' => true,
]);

private function showBotStats(): void
{
    $metrics = app(BotMetrics::class)->collectMetrics();
    
    $message = "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞**\n\n";
    
    // –°–æ–æ–±—â–µ–Ω–∏—è
    $message .= "üì® **–°–æ–æ–±—â–µ–Ω–∏—è (24—á):**\n";
    $message .= "–í—Å–µ–≥–æ: {$metrics['messages']['last_24h']}\n";
    
    foreach ($metrics['messages']['by_type'] as $type => $count) {
        $icon = $this->getTypeIcon($type);
        $message .= "{$icon} {$type}: {$count}\n";
    }
    
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    $message .= "\nüë• **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**\n";
    $message .= "–ê–∫—Ç–∏–≤–Ω—ã—Ö (24—á): {$metrics['users']['active_24h']}\n";
    $message .= "–ù–æ–≤—ã—Ö (24—á): {$metrics['users']['new_users']}\n";
    $message .= "–í—Å–µ–≥–æ: {$metrics['users']['total_users']}\n";
    
    // –ö–æ–º–∞–Ω–¥—ã
    $message .= "\n‚ö° **–ö–æ–º–∞–Ω–¥—ã (24—á):**\n";
    $message .= "–í—ã–ø–æ–ª–Ω–µ–Ω–æ: {$metrics['commands']['executions']}\n";
    $message .= "–û—à–∏–±–æ–∫: {$metrics['commands']['errors']}\n";
    
    $popularCommands = array_slice($metrics['commands']['most_popular'], 0, 5);
    $message .= "\n–¢–æ–ø-5 –∫–æ–º–∞–Ω–¥:\n";
    foreach ($popularCommands as $cmd => $count) {
        $message .= "/{$cmd}: {$count}\n";
    }
    
    // –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    $message .= "\nüöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**\n";
    $message .= "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {$metrics['performance']['avg_response_time']}ms\n";
    $message .= "–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫: {$metrics['performance']['error_rate']}%\n";
    $message .= "Uptime: {$metrics['performance']['uptime']}%\n";
    
    $this->sendSelf($message);
}
```

## –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```php
// config/tegbot.php
'monitoring' => [
    'alerts' => [
        'enabled' => true,
        'channels' => ['telegram', 'email', 'slack'],
        'thresholds' => [
            'error_rate' => 5,        // –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫
            'response_time' => 2000,  // –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
            'memory_usage' => 80,     // –ø—Ä–æ—Ü–µ–Ω—Ç
            'disk_usage' => 85,       // –ø—Ä–æ—Ü–µ–Ω—Ç
        ],
        'cooldown_minutes' => 15,     // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∞–ª–µ—Ä—Ç–∞–º–∏
    ],
],
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

```php
class AlertManager
{
    public function checkAndSendAlerts(): void
    {
        $metrics = app(BotMetrics::class)->collectMetrics();
        $thresholds = config('tegbot.monitoring.alerts.thresholds');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—à–∏–±–æ–∫
        if ($metrics['performance']['error_rate'] > $thresholds['error_rate']) {
            $this->sendAlert('high_error_rate', [
                'current' => $metrics['performance']['error_rate'],
                'threshold' => $thresholds['error_rate'],
            ]);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
        if ($metrics['performance']['avg_response_time'] > $thresholds['response_time']) {
            $this->sendAlert('slow_response', [
                'current' => $metrics['performance']['avg_response_time'],
                'threshold' => $thresholds['response_time'],
            ]);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
        $memoryUsage = $this->getMemoryUsagePercent();
        if ($memoryUsage > $thresholds['memory_usage']) {
            $this->sendAlert('high_memory_usage', [
                'current' => $memoryUsage,
                'threshold' => $thresholds['memory_usage'],
            ]);
        }
    }
    
    private function sendAlert(string $type, array $data): void
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º cooldown
        if (!$this->canSendAlert($type)) {
            return;
        }
        
        $message = $this->formatAlertMessage($type, $data);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram –∞–¥–º–∏–Ω–∞–º
        $this->sendToAdmins("üö® {$message}");
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ email
        if (config('tegbot.monitoring.alerts.channels.email')) {
            Mail::to(config('tegbot.admin_email'))->send(new BotAlert($type, $data));
        }
        
        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç–∞
        $this->recordAlertSent($type);
    }
    
    private function formatAlertMessage(string $type, array $data): string
    {
        $messages = [
            'high_error_rate' => "–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫: {$data['current']}% (–ª–∏–º–∏—Ç: {$data['threshold']}%)",
            'slow_response' => "–ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: {$data['current']}ms (–ª–∏–º–∏—Ç: {$data['threshold']}ms)",
            'high_memory_usage' => "–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {$data['current']}% (–ª–∏–º–∏—Ç: {$data['threshold']}%)",
            'api_down' => "Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω",
            'webhook_failed' => "Webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç",
        ];
        
        return $messages[$type] ?? "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: {$type}";
    }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```php
// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    $schedule->command('teg:health')
        ->everyFiveMinutes()
        ->withoutOverlapping();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    $schedule->call(function () {
        app(AlertManager::class)->checkAndSendAlerts();
    })->everyMinute();
    
    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
    $schedule->command('teg:logs:cleanup')
        ->daily();
    
    // –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
    $schedule->call(function () {
        $this->sendWeeklyReport();
    })->weekly();
}
```

## –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### Debug —Ä–µ–∂–∏–º

```php
// .env
TEGBOT_DEBUG=true
TEGBOT_LOG_LEVEL=debug

// –í –±–æ—Ç–µ
public function main(): void
{
    if (config('tegbot.debug')) {
        $this->enableDebugMode();
    }
    
    // –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}

private function enableDebugMode(): void
{
    // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    $this->globalMiddleware(['debug_logging']);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∞–¥–º–∏–Ω–∞–º
    $this->debugToAdmins([
        'memory' => memory_get_usage(true),
        'time' => microtime(true),
        'request' => request()->all(),
    ]);
}
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```php
class BotDebugger
{
    public function diagnose(): array
    {
        return [
            'environment' => $this->getEnvironmentInfo(),
            'configuration' => $this->getConfigurationInfo(),
            'dependencies' => $this->checkDependencies(),
            'permissions' => $this->checkPermissions(),
            'connectivity' => $this->checkConnectivity(),
            'recent_errors' => $this->getRecentErrors(),
        ];
    }
    
    private function getEnvironmentInfo(): array
    {
        return [
            'php_version' => PHP_VERSION,
            'laravel_version' => app()->version(),
            'tegbot_version' => $this->getTegBotVersion(),
            'server_software' => $_SERVER['SERVER_SOFTWARE'] ?? 'Unknown',
            'memory_limit' => ini_get('memory_limit'),
            'max_execution_time' => ini_get('max_execution_time'),
            'timezone' => config('app.timezone'),
        ];
    }
    
    private function checkDependencies(): array
    {
        $checks = [
            'curl' => extension_loaded('curl'),
            'json' => extension_loaded('json'),
            'openssl' => extension_loaded('openssl'),
            'redis' => class_exists('Redis'),
            'gd' => extension_loaded('gd'),
        ];
        
        return array_map(function ($loaded) {
            return $loaded ? 'OK' : 'Missing';
        }, $checks);
    }
    
    private function checkPermissions(): array
    {
        $paths = [
            'storage/logs' => storage_path('logs'),
            'storage/app/tegbot' => storage_path('app/tegbot'),
            'bootstrap/cache' => base_path('bootstrap/cache'),
        ];
        
        $permissions = [];
        foreach ($paths as $name => $path) {
            $permissions[$name] = [
                'exists' => file_exists($path),
                'readable' => is_readable($path),
                'writable' => is_writable($path),
                'permissions' => $this->getPermissions($path),
            ];
        }
        
        return $permissions;
    }
}
```

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```php
class BotProfiler
{
    private array $timers = [];
    private array $memoryPoints = [];
    
    public function start(string $name): void
    {
        $this->timers[$name] = microtime(true);
        $this->memoryPoints[$name . '_start'] = memory_get_usage(true);
    }
    
    public function end(string $name): array
    {
        $endTime = microtime(true);
        $endMemory = memory_get_usage(true);
        
        $startTime = $this->timers[$name] ?? $endTime;
        $startMemory = $this->memoryPoints[$name . '_start'] ?? $endMemory;
        
        return [
            'duration' => round(($endTime - $startTime) * 1000, 2), // ms
            'memory_used' => $endMemory - $startMemory,
            'peak_memory' => memory_get_peak_usage(true),
        ];
    }
    
    public function profile(string $name, callable $callback)
    {
        $this->start($name);
        $result = $callback();
        $stats = $this->end($name);
        
        // –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
        Log::debug("TegBot Profile: {$name}", $stats);
        
        return $result;
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
$profiler = app(BotProfiler::class);

$profiler->profile('command_execution', function () use ($command, $args) {
    return $this->executeCommand($command, $args);
});
```

## –ö–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
php artisan teg:health

# –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
php artisan teg:diagnose

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
php artisan teg:stats

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
php artisan teg:errors --last=24h

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
php artisan teg:logs:cleanup --days=30

# –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
php artisan teg:metrics:export --format=json

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
php artisan teg:benchmark

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
php artisan teg:webhook:test
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### Grafana Dashboard

```json
{
  "dashboard": {
    "title": "TegBot Monitoring",
    "panels": [
      {
        "title": "Messages per minute",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(tegbot_messages_total[1m])",
            "legendFormat": "Messages/min"
          }
        ]
      },
      {
        "title": "Response Time",
        "type": "graph", 
        "targets": [
          {
            "expr": "histogram_quantile(0.95, tegbot_response_time_histogram)",
            "legendFormat": "95th percentile"
          }
        ]
      }
    ]
  }
}
```

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

```php
// –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è Prometheus
Route::get('/metrics', function () {
    $metrics = app(BotMetrics::class)->collectMetrics();
    
    $prometheus = '';
    $prometheus .= "# HELP tegbot_messages_total Total messages processed\n";
    $prometheus .= "# TYPE tegbot_messages_total counter\n";
    $prometheus .= "tegbot_messages_total {$metrics['messages']['last_24h']}\n\n";
    
    $prometheus .= "# HELP tegbot_active_users Active users in last 24h\n";
    $prometheus .= "# TYPE tegbot_active_users gauge\n";
    $prometheus .= "tegbot_active_users {$metrics['users']['active_24h']}\n\n";
    
    return response($prometheus)->header('Content-Type', 'text/plain');
});
```

---

üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ TegBot** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–æ—Ç–∞! 
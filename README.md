# Telegram Bot SDK Laravel

–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤ –Ω–∞ Laravel —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º—É–ª—å—Ç–∏–±–æ—Ç–∞ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **–ú—É–ª—å—Ç–∏–±–æ—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –±–æ—Ç–∞–º–∏
- üîÑ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∏ –¥–æ–º–µ–Ω—ã –¥–ª—è dev/prod
- üåç **i18n –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- üõ†Ô∏è **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã** - —É–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI
- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - webhook secrets, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–æ—Ç–æ–≤, –º–µ—Ç—Ä–∏–∫–∏
- üóÑÔ∏è **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- üöÄ **–ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã** - –±—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
composer require tbot/laravel
```
```bash
php artisan vendor:publish --provider="Bot\Providers\BotServiceProvider"
```
```bash
php artisan migrate
```




## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

```bash
php artisan bot:new
```

–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ–¥–µ—Ç –≤–∞—Å —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É:
- –í–≤–æ–¥ –∏–º–µ–Ω–∏ –±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è dev –∏ prod –æ–∫—Ä—É–∂–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–æ–≤ –¥–ª—è dev –∏ prod –æ–∫—Ä—É–∂–µ–Ω–∏–π
- –£–∫–∞–∑–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–æ—Ç–æ–≤
php artisan bot:manage list

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –±–æ—Ç–µ
php artisan bot:manage show mybot

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–æ—Ç–∞
php artisan bot:manage enable mybot
php artisan bot:manage disable mybot

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
php artisan bot:manage test mybot
```

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞–º–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–º–µ–Ω–∞ –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
php artisan bot:domain set mybot dev https://dev.example.com
php artisan bot:domain set mybot prod https://example.com

# –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–º–µ–Ω–æ–≤ –±–æ—Ç–∞
php artisan bot:domain show mybot

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
php artisan bot:domain list
```

### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–º–µ–Ω –∏–∑ –ë–î)
php artisan bot:webhook set mybot

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook
php artisan bot:webhook info mybot

# –£–¥–∞–ª–µ–Ω–∏–µ webhook
php artisan bot:webhook delete mybot

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
php artisan bot:webhook test mybot
```

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π

–§—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥–æ–º–µ–Ω–æ–≤ –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º:

### –¢–æ–∫–µ–Ω—ã
- `dev_token` - —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `prod_token` - —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –î–æ–º–µ–Ω—ã
- `dev_domain` - –¥–æ–º–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://dev.example.com)
- `prod_domain` - –¥–æ–º–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://example.com)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `APP_ENV`:
- `APP_ENV=dev` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç dev_token –∏ dev_domain
- `APP_ENV=prod` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç prod_token –∏ prod_domain

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```php
// –í –∫–æ–¥–µ –±–æ—Ç–∞
$bot = Bot::find(1);

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
$token = $bot->getTokenAttribute();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
$domain = $bot->getDomainAttribute();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
$devToken = $bot->getTokenForEnvironment('dev');
$prodDomain = $bot->getDomainForEnvironment('prod');
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ Bots/                    # –ö–ª–∞—Å—Å—ã –±–æ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ AbstractBot.php     # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ MyBot.php          # –í–∞—à –±–æ—Ç
‚îú‚îÄ‚îÄ Console/Commands/       # CLI –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ BotCommand.php     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ SetupCommand.php   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ WebhookCommand.php # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook
‚îÇ   ‚îî‚îÄ‚îÄ DomainCommand.php  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞–º–∏
‚îî‚îÄ‚îÄ Models/
    ‚îî‚îÄ‚îÄ Bot.php            # –ú–æ–¥–µ–ª—å –±–æ—Ç–∞

config/
‚îî‚îÄ‚îÄ bot.php               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

database/migrations/      # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config/bot.php`:

```php
return [
    'multibot' => [
        'enabled' => true,
        'auto_create_classes' => true,
        'bots_path' => 'App\\Bots',
    ],
    
    'webhook' => [
        'base_url' => env('BOT_WEBHOOK_BASE_URL', env('APP_URL')),
        'auto_generate_secret' => true,
    ],
    
    'security' => [
        'webhook_secret' => env('BOT_WEBHOOK_SECRET'),
        'admin_ids' => array_filter(explode(',', env('BOT_ADMIN_IDS', ''))),
    ],
];
```

## –ö–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `bot:new` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ |
| `bot:manage list` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–æ—Ç–æ–≤ |
| `bot:manage show {bot}` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ |
| `bot:manage test {bot}` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞ |
| `bot:webhook set {bot}` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook |
| `bot:domain set {bot} {env} {domain}` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–º–µ–Ω–∞ |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞–º–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `bot:domain set {bot} {env} {domain}` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–º–µ–Ω–∞ |
| `bot:domain show {bot}` | –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–º–µ–Ω–æ–≤ –±–æ—Ç–∞ |
| `bot:domain list` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `bot:webhook set {bot} {url?}` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook |
| `bot:webhook info {bot}` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook |
| `bot:webhook delete {bot}` | –£–¥–∞–ª–µ–Ω–∏–µ webhook |
| `bot:webhook test {bot}` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook |

## –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (i18n)

–§—Ä–µ–π–º–≤–æ—Ä–∫ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è

–î–æ–±–∞–≤—å—Ç–µ I18nModule –≤ –≤–∞—à –±–æ—Ç:

```php
use Bot\Modules\I18nModule;

class MyBot extends LightBot
{
    use I18nModule;
    
    public function start()
    {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –≤ sendSelf/sendOut
        $this->sendSelf('messages.welcome', [
            ['messages.button.start'],
            ['messages.button.help']
        ]);
    }
}
```

### –†—É—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥

```php
// –ü–µ—Ä–µ–≤–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
$greeting = $this->translate('messages.user.greeting', ['name' => 'John']);

// –ü–µ—Ä–µ–≤–æ–¥ –º–∞—Å—Å–∏–≤–æ–≤
$buttons = $this->translateArray([
    ['messages.button.start'],
    ['messages.button.help']
]);
```

### –§–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ `resources/lang/{locale}/`:

```php
// resources/lang/en/messages.php
return [
    'welcome' => 'Welcome to our bot!',
    'button' => [
        'start' => 'Start',
        'help' => 'Help',
    ],
    'user' => [
        'greeting' => 'Hello, :name!',
    ],
];
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [I18N_USAGE.md](I18N_USAGE.md)

## –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–ª–∞—Å—Å:

```php
<?php

namespace App\Bots;

class MyBot extends AbstractBot
{
    public function main(): void
    {
        $this->commands();
        
        if ($this->hasMessageText() && $this->isMessageCommand()) {
            $this->handleCommand($this->getMessageText());
        }
    }

    public function commands(): void
    {
        $this->registerCommand('start', function () {
            $this->sendSelf('üéâ –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç MyBot');
        }, [
            'description' => '–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞'
        ]);

        $this->registerCommand('help', function () {
            $this->sendSelf([
                'üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:', 
                '', 
                '/start - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞', 
                '/help - –ü–æ–º–æ—â—å'
            ]);
        }, [
            'description' => '–ü–æ–º–æ—â—å'
        ]);
    }
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è webhook secrets
- üõ°Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥–æ–º–µ–Ω–æ–≤
- üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- üö´ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ rate limiting
- üë• –°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤—Å–µ—Ö –±–æ—Ç–æ–≤
php artisan bot:health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
php artisan bot:stats

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
php artisan bot:config show
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License 
